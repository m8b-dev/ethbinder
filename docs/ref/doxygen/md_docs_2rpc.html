<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.12.0"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Ether Binder: JSON RPC client</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<script type="text/javascript" src="clipboard.js"></script>
<link href="navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="navtreedata.js"></script>
<script type="text/javascript" src="navtree.js"></script>
<script type="text/javascript" src="resize.js"></script>
<script type="text/javascript" src="cookie.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Ether Binder
   </div>
   <div id="projectbrief">Set of utilities for interacting with Ethereum and it&#39;s smart contracts with PHP, with generating ABI bindings and Ethereum-related types</div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.12.0 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "search/",'.html');
/* @license-end */
</script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() { codefold.init(0); });
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('',true,false,'search.php','Search',true);
  $(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function(){initNavTree('md_docs_2rpc.html',''); initResizable(true); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">JSON RPC client</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="autotoc_md31"></a></p>
<p>Ether Binder comes with HTTP JSON RPC client. It's used with execution client to interact with blockchain. It facilitates such operations as reading blocks, fetching and sending transactions and such.</p>
<h1><a class="anchor" id="autotoc_md32"></a>
Instantiation</h1>
<p>Right now only http[s] RPC is supported. To instantiate it, just pass url. For some RPC providers you may need custom headers for example for authorization. Only required parameter is url. Note that <code>Content-Type</code> header will always be set to <code>application/json</code>, even its set in param to be something else</p>
<div class="fragment"><div class="line">$rpc = new \M8B\EtherBinder\RPC\HttpRPC(<span class="stringliteral">&quot;https://example.com&quot;</span>, [<span class="stringliteral">&quot;X-Api-Key&quot;</span> =&gt; <span class="stringliteral">&quot;foo-bar&quot;</span>])</div>
</div><!-- fragment --><h1><a class="anchor" id="autotoc_md33"></a>
Usage</h1>
<h2><a class="anchor" id="autotoc_md34"></a>
Naming</h2>
<p>RPC follows naming convention of following RPC function names, removing <code>_</code> to split function name. For example <code>eth_getBlockByHash</code> becomes <code>ethGetBlockByHash</code>.</p>
<h2><a class="anchor" id="autotoc_md35"></a>
Block number param</h2>
<p>Some endpoints require block number parameter, which is either string or block number on RPC. In Ether-Binder the parameter becomes int or enum (<code>BlockParam</code>). Available <code>BlockParam</code>s: </p><div class="fragment"><div class="line">BlockParam::LATEST</div>
<div class="line">BlockParam::EARLIEST</div>
<div class="line">BlockParam::PENDING</div>
<div class="line">BlockParam::SAFE</div>
<div class="line">BlockParam::FINALIZED</div>
</div><!-- fragment --><p> Names of these are consistent with RPC.</p>
<h2><a class="anchor" id="autotoc_md36"></a>
Endpoint specific reference</h2>
<p>There is no documentation for specific RPC points in Ether-Binder library, as you will get the best with official JSON RPC of either your specific provider, or your specific execution client <a href="https://geth.ethereum.org/docs/interacting-with-geth/rpc">like this for geth</a>, or you can always see <a href="https://ethereum.org/en/developers/docs/apis/json-rpc/">this official docs</a> or <a href="https://ethereum.github.io/execution-apis/api-documentation/">this official spec</a>. Since there is plenty of documentation for these, it would be redundant and counter-productive to rewrite this.</p>
<p>If you take RPC as parameter, you <b>SHOULD</b> type for <code>AbstractRPC</code>, not <code>HttpRPC</code>. This allows in future implementation of different transports</p>
<h2><a class="anchor" id="autotoc_md37"></a>
Missing methods</h2>
<p>Some clients implement additional functions which differ from the official spec. Most often used function that can be an example is <code>debug_traceTransaction</code>. While very common method, it's not standard as per spec. To call non-standard method, use <code>runRpc</code> method.</p>
<div class="fragment"><div class="line">$rpc-&gt;runRpc(<span class="stringliteral">&quot;module_someMethod&quot;</span>, [<span class="stringliteral">&quot;param1&quot;</span>, <span class="stringliteral">&quot;param2&quot;</span>]);</div>
</div><!-- fragment --><p>Note that this function requires strings as inputs. Most of Ether Binder types support functions that should help you, such as <code>toHex()</code> and <code>encodeHex()</code>. Output is always array, as this function is unaware if return type is single value or not. For single returns, it might be most convenient to use <code>::fromHex()</code> static functions.</p>
<h1><a class="anchor" id="autotoc_md38"></a>
Adding more supported protocols</h1>
<p>Create new class, that extends <code>AbstractRPC</code> and implement <code>__construct</code> to your liking. Next, you need to implement one function to make it functional: </p><div class="fragment"><div class="line"><span class="keyword">public</span> <span class="keyword">function</span> raw(<span class="keywordtype">string</span> $method, ?array $params = <span class="keyword">null</span>): array</div>
</div><!-- fragment --><p>It's your responsibility to track <code>id</code> of the request.</p>
<p>You must ensure only exception that will be thrown is <code>M8B\EtherBinder\Exceptions\RPCGeneralException</code>.</p>
<p>You put zero effort beyond <code>json_decode</code> into parsing the output, the AbstractRPC will take care of this. Note 2 things:</p><ul>
<li>you should use JSON_THROW_ON_ERROR to be able to catch it and throw RPCGeneralException</li>
<li>you must decode with assoc param set to true</li>
</ul>
<p>If <code>$params</code> is null, set it to empty array - <code>[]</code></p>
<p>Param <code>$method</code> should be passed "as-is" to the RPC, same with params.</p>
<p>Return output array "as is".</p>
<h1><a class="anchor" id="autotoc_md39"></a>
Internal structure</h1>
<p>Specific method bindings are split into modules: </p><div class="fragment"><div class="line">AbstractModule</div>
<div class="line">Debug</div>
<div class="line">Eth</div>
<div class="line">Net</div>
<div class="line">Web3</div>
</div><!-- fragment --><p>Each one extends previous one, in alphabetical order, AbstractModule MUST be parent of all of them. It defines abstract function that is implemented by AbstractRPC to actually call the RPC, and AbstractRPC is child of last Compound, and it's parent of AbstractRPC. This approach allows nice division for modules. Compound is special class that contains non-existent RPCs that may be useful. Right now it only provides <code>calcAvgTip</code> and <code>isLookingLikeLondon</code> helper functions required for internal creation of transactions (one decides if we need to create London Transaction or Legacy one, another one helps to decide what's average miner Tip value, to use that as default tip)</p>
<p>There are some helpers for making api more convenient. Eth module contains helper that parses transaction into message (since this library avoids Message). AbstractModule contains helper to allow accepting Block or Hash for block hash, and to parse BlockParam into RPC value. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.12.0 </li>
  </ul>
</div>
</body>
</html>
